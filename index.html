<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Happy Birthday â€” Make a Wish</title>
  <style>
    :root{
      --bg: #FFF5FB;
      --card: #fff;
      --accent: #e84c88;
      --cake-top: linear-gradient(180deg,#ffd7e8 0%, #ffc0d9 100%);
      --cake-side: linear-gradient(180deg,#ff9fbe 0%, #ff6f98 100%);
      --cream: linear-gradient(180deg,#fff 0%, #fff3f8 100%);
      --shadow: rgba(0,0,0,0.12);
      --soft: 12px;
    }

    html,body{height:100%;margin:0;font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;color:#3b2b3b}
    body{background:var(--bg);display:flex;align-items:center;justify-content:center;padding:28px}

    .stage{width:100%;max-width:760px;background:transparent;border-radius:16px;padding:28px;box-sizing:border-box;text-align:center}
    h1{margin:0 0 6px;font-size:24px;color:#52243a}
    p.lead{margin:0 0 18px;color:#6b4755}

    /* cake wrapper */
    .cake-wrap{display:inline-block;position:relative;width:360px;max-width:76vw}

    /* top plate */
    .plate{
      width:100%;height:28px;background:transparent;position:absolute;left:0;bottom:-22px;filter:blur(0.6px);transform:translateY(6px);
    }

    /* cake layers */
    .cake{
      width:100%;height:180px;border-radius:20px;position:relative;box-shadow:0 22px 40px var(--shadow), inset 0 6px 14px rgba(255,255,255,0.25);
      transform:translateY(0);overflow:visible
    }

    .cake .side{
      position:absolute;left:0;right:0;bottom:0;height:100%;border-radius:20px;padding-top:18px;box-sizing:border-box;background:var(--cake-side);
      display:flex;flex-direction:column;align-items:center;justify-content:flex-start
    }

    .cake .top-cream{
      width:92%;height:62px;border-radius:14px;background:var(--cream);margin-top:6px;box-shadow:0 6px 18px rgba(0,0,0,0.06) inset, 0 10px 20px rgba(0,0,0,0.06)
    }

    .swirls{display:flex;gap:12px;justify-content:center;margin-top:-6px}
    .swirl{width:36px;height:12px;border-radius:12px;background:linear-gradient(90deg,#ffe2f0,#ffd0e6);transform:rotate(-8deg);box-shadow:0 2px 4px rgba(0,0,0,0.03)}

    /* Candle */
    .candle{
      width:18px;height:70px;background:#ffe9f3;border-radius:6px;position:absolute;left:50%;transform:translateX(-50%);top:-26px;display:flex;align-items:flex-start;justify-content:center;box-shadow:0 6px 14px rgba(0,0,0,0.09)
    }
    .candle:after{content:'';width:100%;height:6px;background:linear-gradient(90deg,#ffd9e9,#ffc7df);position:absolute;bottom:0;border-radius:0 0 4px 4px}

    .wick{width:2px;height:12px;background:#3b2b3b;margin-top:8px;border-radius:2px}

    .flame-wrap{position:relative;margin-top:-6px;pointer-events:none}
    .flame{width:18px;height:28px;border-radius:50% 50% 40% 40%;position:relative;transform-origin:center bottom;filter:blur(0.4px);
      background: radial-gradient(circle at 50% 35%, #fff7c6 0%, #ffd57a 18%, #ff9a8a 52%, rgba(255,125,145,0.9) 78%);
      box-shadow:0 6px 24px rgba(232,76,136,0.14),0 2px 8px rgba(255,150,140,0.12);
      animation: flameSoft 900ms infinite ease-in-out;
    }
    .flame::after{content:'';position:absolute;left:50%;transform:translateX(-50%);bottom:-6px;width:34px;height:18px;border-radius:50%;filter:blur(10px);background:radial-gradient(closest-side, rgba(232,76,136,0.12), rgba(232,76,136,0));opacity:0.95}

    @keyframes flameSoft{
      0%{transform:translateY(0) scale(1);}50%{transform:translateY(-6px) scale(0.92);}100%{transform:translateY(0) scale(1)}
    }

    .spark{position:absolute;width:6px;height:6px;border-radius:50%;background:rgba(255,220,120,0.95);opacity:0.9;box-shadow:0 2px 8px rgba(255,180,120,0.2)}

    .message{margin-top:22px;padding:18px;border-radius:12px;background:linear-gradient(180deg,#fff 0%, #fff3f8 100%);box-shadow:0 10px 30px rgba(0,0,0,0.06);display:none;opacity:0;transform:translateY(6px);transition:all .8s cubic-bezier(.2,.9,.3,1)}
    .message.show{display:block;opacity:1;transform:translateY(0)}

    .controls{margin-top:14px;display:flex;gap:10px;justify-content:center}
    button{background:var(--accent);color:white;padding:10px 14px;border-radius:10px;border:0;cursor:pointer;font-weight:600;box-shadow:0 6px 18px rgba(232,76,136,0.18)}
    button.secondary{background:transparent;color:var(--accent);border:1px solid rgba(232,76,136,0.12);box-shadow:none}

    @media (max-width:520px){
      .cake-wrap{width:320px}
      .cake{height:150px}
      .candle{height:58px;width:14px}
      .flame{width:14px;height:22px}
      h1{font-size:20px}
    }
  </style>
</head>
<body>
  <div class="stage">
    <h1>ðŸŽ‚ DoÄŸum GÃ¼nÃ¼ SÃ¼rprizi</h1>
    <p class="lead">Telefonun mikrofonuna Ã¼fle â€” mum sÃ¶ndÃ¼ÄŸÃ¼nde sÃ¼rpriz mesajÄ± Ã§Ä±kacak âœ¨</p>

    <div class="cake-wrap" id="scene">
      <div class="plate"></div>
      <div class="cake" aria-hidden="true">
        <div class="side">
          <div class="top-cream">
            <div class="swirls" aria-hidden="true">
              <div class="swirl"></div>
              <div class="swirl"></div>
              <div class="swirl"></div>
            </div>
          </div>
          <div class="candle" id="candle">
            <div class="wick"></div>
            <div class="flame-wrap">
              <div class="flame" id="flame"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="controls">
      <button id="allowMic">Mikrofonu BaÅŸlat</button>
      <button id="relight" class="secondary">Tekrar Yak</button>
    </div>

    <div class="message" id="message">
      <h2>ðŸŽ‰ DoÄŸum GÃ¼nÃ¼n Kutlu Olsun!</h2>
      <p style="margin:6px 0 0">Seni Ã§ok seviyorum â€” tÃ¼m dileklerin gerÃ§ek olsun. ðŸ’–</p>
    </div>
  </div>

  <script>
    const flame = document.getElementById('flame');
    const message = document.getElementById('message');
    const allowMic = document.getElementById('allowMic');
    const relight = document.getElementById('relight');

    let audioCtx, analyser, source, dataArr, micStream;
    let blown = false;

    function showMessage(){
      message.classList.add('show');
    }

    function blowOutVisual(){
      if(blown) return;
      flame.style.transition = 'opacity 450ms ease, transform 600ms ease';
      flame.style.opacity = '0';
      flame.style.transform = 'translateY(-4px) scale(0.85)';
      spawnSparks(8);
      setTimeout(()=>{
        flame.style.display = 'none';
        showMessage();
        blown = true;
      }, 550);
    }

    function relightCandle(){
      blown = false;
      message.classList.remove('show');
      flame.style.display = '';
      flame.style.opacity = '1';
      flame.style.transform = 'translateY(0) scale(1)';
    }

    allowMic.addEventListener('click', async ()=>{
      if(audioCtx) return;
      try{
        micStream = await navigator.mediaDevices.getUserMedia({audio:true});
        audioCtx = new (window.AudioContext||window.webkitAudioContext)();
        source = audioCtx.createMediaStreamSource(micStream);
        analyser = audioCtx.createAnalyser();
        analyser.fftSize = 256;
        dataArr = new Uint8Array(analyser.frequencyBinCount);
        source.connect(analyser);
        monitorBlow();
        allowMic.textContent = 'Mikrofon Aktif';
        allowMic.disabled = true;
      }catch(err){
        alert('Mikrofon eriÅŸimi reddedildi veya desteklenmiyor.');
      }
    });

    function monitorBlow(){
      analyser.getByteFrequencyData(dataArr);
      let sum = 0;
      for(let i=0;i<dataArr.length;i++) sum += dataArr[i];
      let avg = sum / dataArr.length;

      let hfSum = 0, hfCount = 0;
      for(let i=Math.floor(dataArr.length*0.6); i<dataArr.length; i++){ hfSum += dataArr[i]; hfCount++; }
      let hfAvg = hfSum / Math.max(1,hfCount);

      if(!blown && ((avg>22 && hfAvg>42) || avg>46)){
        blowOutVisual();
      }

      requestAnimationFrame(monitorBlow);
    }

    function spawnSparks(n){
      const wrap = document.getElementById('scene');
      for(let i=0;i<n;i++){
        const s = document.createElement('div');
        s.className = 'spark';
        const left = (wrap.clientWidth/2) + (Math.random()*36-18);
        const top = (wrap.clientHeight*0.18) + (Math.random()*8 - 6);
        s.style.left = left + 'px';
        s.style.top = top + 'px';
        s.style.opacity = Math.random()*0.9+0.4;
        s.style.transform = 'scale('+ (Math.random()*0.9+0.5) +')';
        wrap.appendChild(s);
        const dx = (Math.random()*80-40);
        const dy = -(Math.random()*80+40);
        s.animate([
          { transform: 'translate(0,0) scale(1)', opacity:1 },
          { transform: `translate(${dx}px, ${dy}px) scale(0.3)`, opacity:0 }
        ],{duration: 900 + Math.random()*600, easing: 'cubic-bezier(.2,.8,.2,1)'});
        setTimeout(()=>{ s.remove(); }, 2000 + Math.random()*1200);
      }
    }
  </script>
</body>
</html>
